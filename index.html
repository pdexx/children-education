<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>互動式換錢遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: space-evenly;
      align-items: flex-start;
      margin: 20px;
    }
    .zone {
      width: 300px;
      height: 400px;
      border: 2px dashed #666;
      border-radius: 10px;
      padding: 10px;
      position: relative;
    }
    .zone h2 {
      text-align: center;
    }
    .coin {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      margin: 5px;
      cursor: grab;
      font-weight: bold;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .coin.ten {
      background-color: #ffd700;
    }
    .coin.five {
      background-color: #a9a9a9;
    }
    .coin.one {
      background-color: #d3d3d3;
    }
    .coin.selected {
      outline: 3px solid blue;
    }
    .counter {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 16px;
      font-weight: bold;
      background: #fff8dc;
      padding: 3px 8px;
      border: 1px solid #aaa;
      border-radius: 5px;
    }
    #lang-toggle {
        position: fixed;
        bottom: 10px;
        right: 10px;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
        background-color: #f0f0f0;
    }
    #game-container {
        display: none;
    }
    #desktop-only-message {
        display: block;
        text-align: center;
        margin-top: 100px;
        font-size: 24px;
        color: #555;
    }
  </style>

  <script>
    function isMobileDevice() {
      return (typeof window.orientation !== "undefined") || (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/iPhone|iPad|iPod/i) || navigator.userAgent.match(/Opera Mini/i) || navigator.userAgent.match(/IEMobile/i));
    }
    if (!isMobileDevice()) {
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('game-container').style.display = 'flex';
        document.getElementById('desktop-only-message').style.display = 'none';
        document.getElementById('lang-toggle').style.display = 'block';
      });
    }
  </script>
</head>
<body>
  <button id="lang-toggle">English / 中文</button>
  
  <div id="desktop-only-message">
    This page is for desktop use only.<br>
    此網頁僅限桌機使用。
  </div>

  <div id="game-container">
    <div id="ten-zone" class="zone">
      <h2 data-lang-key="tenZoneTitle">10元區</h2>
      <div class="coin ten" draggable="true">10</div>
      <div id="ten-counter" class="counter">
        <span data-lang-key="selectedText">選取</span>：
        <span class="count">0</span>
      </div>
    </div>

    <div id="five-zone" class="zone">
      <h2 data-lang-key="fiveZoneTitle">5元區</h2>
      <div class="coin five" draggable="true">5</div>
      <div id="five-counter" class="counter">
        <span data-lang-key="selectedText">選取</span>：
        <span class="count">0</span>
      </div>
    </div>

    <div id="one-zone" class="zone">
      <h2 data-lang-key="oneZoneTitle">1元區</h2>
      <div id="one-counter" class="counter">
        <span data-lang-key="selectedText">選取</span>：
        <span class="count">0</span>
      </div>
    </div>
  </div>

  <audio id="coin-sound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
  <audio id="click-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

  <script>
    const tenZone = document.getElementById("ten-zone");
    const fiveZone = document.getElementById("five-zone");
    const oneZone = document.getElementById("one-zone");
    const langToggleBtn = document.getElementById("lang-toggle");
    const gameContainer = document.getElementById("game-container");
    const desktopOnlyMessage = document.getElementById("desktop-only-message");

    const tenCounter = document.getElementById("ten-counter");
    const oneCounter = document.getElementById("one-counter");
    const fiveCounter = document.getElementById("five-counter");

    const coinSound = document.getElementById("coin-sound");
    const clickSound = document.getElementById("click-sound");

    let selectedTens = [];
    let selectedOnes = [];
    let selectedFives = [];

    // 語言內容
    const langContent = {
      zh: {
        tenZoneTitle: '10元區',
        fiveZoneTitle: '5元區',
        oneZoneTitle: '1元區',
        selectedText: '選取',
      },
      en: {
        tenZoneTitle: '10 Dollar Zone',
        fiveZoneTitle: '5 Dollar Zone',
        oneZoneTitle: '1 Dollar Zone',
        selectedText: 'Selected',
      }
    };
    let currentLang = 'zh';

    // 初始化 13 個 1元
    for (let i = 0; i < 13; i++) {
      addCoin("one", oneZone);
    }

    function updateCounters() {
      const selectedText = langContent[currentLang].selectedText;
      tenCounter.querySelector('[data-lang-key="selectedText"]').textContent = selectedText;
      tenCounter.querySelector('.count').textContent = selectedTens.length;
      oneCounter.querySelector('[data-lang-key="selectedText"]').textContent = selectedText;
      oneCounter.querySelector('.count').textContent = selectedOnes.length;
      fiveCounter.querySelector('[data-lang-key="selectedText"]').textContent = selectedText;
      fiveCounter.querySelector('.count').textContent = selectedFives.length;
    }

    // 語言切換功能
    function switchLang() {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      document.documentElement.lang = currentLang;

      document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        element.textContent = langContent[currentLang][key];
      });
      updateCounters();
    }
    langToggleBtn.addEventListener('click', switchLang);

    // 事件委託：統一處理拖曳行為
    document.addEventListener("dragstart", e => {
      const target = e.target;
      if (!target.classList.contains("coin")) {
        e.preventDefault();
        return;
      }
      
      e.dataTransfer.setDragImage(target, 20, 20);

      if (target.classList.contains("ten")) {
        if (selectedTens.length > 0) {
            e.dataTransfer.setData("coin-type", "ten-group");
            e.dataTransfer.setData("ten-count", selectedTens.length);
        } else {
            e.dataTransfer.setData("coin-type", "ten-single");
        }
      } else if (target.classList.contains("five")) {
        if (selectedFives.length > 0) {
            e.dataTransfer.setData("coin-type", "five-group");
            e.dataTransfer.setData("five-count", selectedFives.length);
        } else {
            e.dataTransfer.setData("coin-type", "five-single");
        }
      } else if (target.classList.contains("one")) {
        if (selectedOnes.length > 0 && selectedOnes.length % 5 === 0) {
          e.dataTransfer.setData("coin-type", "one-group");
          e.dataTransfer.setData("one-count", selectedOnes.length);
        } else {
          e.preventDefault();
        }
      }
    });

    // 拖曳放置邏輯
    const zones = [tenZone, fiveZone, oneZone];
    zones.forEach(zone => {
      zone.addEventListener("dragover", e => e.preventDefault());
      zone.addEventListener("drop", e => {
        e.preventDefault();
        const droppedType = e.dataTransfer.getData("coin-type");
        const droppedZone = e.currentTarget;

        // 處理 10 元硬幣的換算
        if (droppedType === "ten-single" || droppedType === "ten-group") {
          const tenCount = (droppedType === "ten-single") ? 1 : parseInt(e.dataTransfer.getData("ten-count"), 10);
          
          if (droppedType === "ten-group") {
            selectedTens.forEach(c => c.remove());
            selectedTens = [];
          } else {
            // 從DOM中找到並移除正在拖曳的那個10元硬幣
            const allTens = Array.from(tenZone.querySelectorAll(".coin.ten"));
            // 避免移除一個未被選中的硬幣
            if (allTens.length > selectedTens.length) {
                const draggableTen = allTens.find(c => !selectedTens.includes(c));
                if (draggableTen) draggableTen.remove();
            }
          }

          if (droppedZone.id === "five-zone") {
            const fiveCount = tenCount * 2;
            for (let i = 0; i < fiveCount; i++) addCoin("five", fiveZone);
            coinSound.currentTime = 0;
            coinSound.play();
          } else if (droppedZone.id === "one-zone") {
            const oneCount = tenCount * 10;
            for (let i = 0; i < oneCount; i++) addCoin("one", oneZone);
            coinSound.currentTime = 0;
            coinSound.play();
          } else if (droppedZone.id === "ten-zone") {
            // 如果放回了10元區，則把它們加回來
            for (let i = 0; i < tenCount; i++) addCoin("ten", tenZone);
          }
          updateCounters();
        }

        // 處理 5 元硬幣（單個或多個）到 1 元區的換算
        else if ((droppedType === "five-single" || droppedType === "five-group") && droppedZone.id === "one-zone") {
            const fiveCount = (droppedType === "five-single") ? 1 : parseInt(e.dataTransfer.getData("five-count"), 10);
            
            if (droppedType === "five-group") {
                selectedFives.forEach(c => c.remove());
                selectedFives = [];
            } else {
                 const allFives = Array.from(fiveZone.querySelectorAll(".coin.five"));
                 if(allFives.length > selectedFives.length){
                    const draggableFive = allFives.find(c => !selectedFives.includes(c));
                    if(draggableFive) draggableFive.remove();
                 }
            }

            const oneCount = fiveCount * 5;
            for (let i = 0; i < oneCount; i++) addCoin("one", oneZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
        }

        // 處理 5 元硬幣群組到 10 元區的換算
        else if (droppedType === "five-group" && droppedZone.id === "ten-zone") {
          const fiveCount = parseInt(e.dataTransfer.getData("five-count"), 10);
          if (fiveCount > 0 && fiveCount % 2 === 0) {
            selectedFives.forEach(c => c.remove());
            selectedFives = [];
            const tenCount = fiveCount / 2;
            for (let i = 0; i < tenCount; i++) addCoin("ten", tenZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
          }
        }

        // 處理 1 元硬幣群組的換算
        else if (droppedType === "one-group") {
          const oneCount = parseInt(e.dataTransfer.getData("one-count"), 10);
          if (droppedZone.id === "five-zone" && oneCount % 5 === 0) {
            selectedOnes.forEach(c => c.remove());
            selectedOnes = [];
            const fiveCount = oneCount / 5;
            for (let i = 0; i < fiveCount; i++) addCoin("five", fiveZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
          } else if (droppedZone.id === "ten-zone" && oneCount % 10 === 0) {
            selectedOnes.forEach(c => c.remove());
            selectedOnes = [];
            const tenCount = oneCount / 10;
            for (let i = 0; i < tenCount; i++) addCoin("ten", tenZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
          }
        }
      });
    });

    // 點擊選取硬幣
    document.addEventListener("click", e => {
      const coin = e.target;
      if (!coin.classList.contains("coin")) return;
      clickSound.currentTime = 0;
      clickSound.play();

      if (coin.classList.contains("one")) {
        if (selectedOnes.includes(coin)) {
          coin.classList.remove("selected");
          selectedOnes = selectedOnes.filter(c => c !== coin);
        } else {
          coin.classList.add("selected");
          selectedOnes.push(coin);
        }
      } else if (coin.classList.contains("five")) {
        if (selectedFives.includes(coin)) {
          coin.classList.remove("selected");
          selectedFives = selectedFives.filter(c => c !== coin);
        } else {
          coin.classList.add("selected");
          selectedFives.push(coin);
        }
      } else if (coin.classList.contains("ten")) {
        if (selectedTens.includes(coin)) {
          coin.classList.remove("selected");
          selectedTens = selectedTens.filter(c => c !== coin);
        } else {
          coin.classList.add("selected");
          selectedTens.push(coin);
        }
      }
      updateCounters();
    });

    // 輔助函式：新增硬幣
    function addCoin(type, zone) {
      const coin = document.createElement("div");
      coin.className = `coin ${type}`;
      coin.textContent = type === "ten" ? "10" : type === "five" ? "5" : "1";
      coin.setAttribute("draggable", "true");
      zone.appendChild(coin);
    }
  </script>
</body>
</html>