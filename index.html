<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>互動式換錢遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      margin: 20px;
    }
    .zone {
      width: 30%;
      min-height: 300px;
      border: 2px dashed #666;
      border-radius: 10px;
      padding: 10px;
      position: relative;
    }
    .zone h2 {
      text-align: center;
    }
    .coin {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      margin: 5px;
      cursor: grab;
      font-weight: bold;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .coin.ten {
      background-color: #ffd700;
    }
    .coin.five {
      background-color: #a9a9a9;
    }
    .coin.one {
      background-color: #d3d3d3;
    }
    .coin.selected {
      outline: 3px solid blue;
    }
    .counter {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 16px;
      font-weight: bold;
      background: #fff8dc;
      padding: 3px 8px;
      border: 1px solid #aaa;
      border-radius: 5px;
    }

    /* 手機版 RWD 樣式 */
    @media (max-width: 600px) {
      body {
        flex-direction: column;
        align-items: center;
      }
      .zone {
        width: 90%;
        margin-bottom: 20px;
      }
      #five-zone {
        display: none; /* 隱藏 5 元區 */
      }
    }
  </style>
</head>
<body>
  <div id="ten-zone" class="zone">
    <h2>10元區</h2>
    <div class="coin ten" draggable="true">10</div>
  </div>

  <div id="five-zone" class="zone">
    <h2>5元區</h2>
    <div class="coin five" draggable="true">5</div>
    <div id="five-counter" class="counter">選取：0</div>
  </div>

  <div id="one-zone" class="zone">
    <h2>1元區</h2>
    <div id="one-counter" class="counter">選取：0</div>
  </div>

  <audio id="coin-sound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
  <audio id="click-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/DragDropTouch/2.0.2/DragDropTouch.js"></script>

  <script>
    const tenZone = document.getElementById("ten-zone");
    const fiveZone = document.getElementById("five-zone");
    const oneZone = document.getElementById("one-zone");

    const oneCounter = document.getElementById("one-counter");
    const fiveCounter = document.getElementById("five-counter");

    const coinSound = document.getElementById("coin-sound");
    const clickSound = document.getElementById("click-sound");

    let selectedOnes = [];
    let selectedFives = [];

    // 初始化 13 個 1元
    for (let i = 0; i < 13; i++) {
      addCoin("one", oneZone);
    }

    function updateCounters() {
      oneCounter.textContent = `選取：${selectedOnes.length}`;
      fiveCounter.textContent = `選取：${selectedFives.length}`;
    }

    document.addEventListener("dragstart", e => {
      const target = e.target;
      if (!target.classList.contains("coin")) {
        e.preventDefault();
        return;
      }
      
      e.dataTransfer.setDragImage(target, 20, 20);
      e.preventDefault(); // 新增的程式碼：阻止預設行為

      if (target.classList.contains("ten")) {
        e.dataTransfer.setData("coin-type", "ten");
      } else if (target.classList.contains("five")) {
        if (selectedFives.length > 0) {
            e.dataTransfer.setData("coin-type", "five-group");
            e.dataTransfer.setData("five-count", selectedFives.length);
        } else {
            e.dataTransfer.setData("coin-type", "five-single");
        }
      } else if (target.classList.contains("one")) {
        if (selectedOnes.length > 0 && selectedOnes.length % 5 === 0) {
          e.dataTransfer.setData("coin-type", "one-group");
          e.dataTransfer.setData("one-count", selectedOnes.length);
        } else {
          e.preventDefault();
        }
      }
    });

    const zones = [tenZone, fiveZone, oneZone];
    zones.forEach(zone => {
      zone.addEventListener("dragover", e => e.preventDefault());

      zone.addEventListener("drop", e => {
        e.preventDefault();
        const droppedType = e.dataTransfer.getData("coin-type");
        const droppedZone = e.currentTarget;
        const draggedCoin = document.querySelector(".coin.ten");

        if (droppedType === "ten") {
          if (draggedCoin) {
            draggedCoin.remove();
            if (droppedZone.id === "five-zone") {
              addCoin("five", fiveZone);
              addCoin("five", fiveZone);
              coinSound.currentTime = 0;
              coinSound.play();
            } else if (droppedZone.id === "one-zone") {
              for (let i = 0; i < 10; i++) addCoin("one", oneZone);
              coinSound.currentTime = 0;
              coinSound.play();
            }
          }
        }

        else if ((droppedType === "five-single" || droppedType === "five-group") && droppedZone.id === "one-zone") {
            const fiveCount = (droppedType === "five-single") ? 1 : parseInt(e.dataTransfer.getData("five-count"), 10);
            
            if (droppedType === "five-group") {
                selectedFives.forEach(c => c.remove());
                selectedFives = [];
            } else {
                const singleFive = document.querySelector(".coin.five");
                if (singleFive) singleFive.remove();
            }

            const oneCount = fiveCount * 5;
            for (let i = 0; i < oneCount; i++) addCoin("one", oneZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
        }

        else if (droppedType === "five-group" && droppedZone.id === "ten-zone") {
          const fiveCount = parseInt(e.dataTransfer.getData("five-count"), 10);
          if (fiveCount > 0 && fiveCount % 2 === 0) {
            selectedFives.forEach(c => c.remove());
            selectedFives = [];
            const tenCount = fiveCount / 2;
            for (let i = 0; i < tenCount; i++) addCoin("ten", tenZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
          }
        }

        else if (droppedType === "one-group") {
          const oneCount = parseInt(e.dataTransfer.getData("one-count"), 10);
          if (droppedZone.id === "five-zone" && oneCount % 5 === 0) {
            selectedOnes.forEach(c => c.remove());
            selectedOnes = [];
            const fiveCount = oneCount / 5;
            for (let i = 0; i < fiveCount; i++) addCoin("five", fiveZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
          } else if (droppedZone.id === "ten-zone" && oneCount % 10 === 0) {
            selectedOnes.forEach(c => c.remove());
            selectedOnes = [];
            const tenCount = oneCount / 10;
            for (let i = 0; i < tenCount; i++) addCoin("ten", tenZone);
            updateCounters();
            coinSound.currentTime = 0;
            coinSound.play();
          }
        }
      });
    });

    document.addEventListener("click", e => {
      const coin = e.target;
      if (!coin.classList.contains("coin")) return;
      clickSound.currentTime = 0;
      clickSound.play();

      if (coin.classList.contains("one")) {
        if (selectedOnes.includes(coin)) {
          coin.classList.remove("selected");
          selectedOnes = selectedOnes.filter(c => c !== coin);
        } else {
          coin.classList.add("selected");
          selectedOnes.push(coin);
        }
      } else if (coin.classList.contains("five")) {
        if (selectedFives.includes(coin)) {
          coin.classList.remove("selected");
          selectedFives = selectedFives.filter(c => c !== coin);
        } else {
          coin.classList.add("selected");
          selectedFives.push(coin);
        }
      }
      updateCounters();
    });

    function addCoin(type, zone) {
      const coin = document.createElement("div");
      coin.className = `coin ${type}`;
      coin.textContent = type === "ten" ? "10" : type === "five" ? "5" : "1";
      coin.setAttribute("draggable", "true");
      zone.appendChild(coin);
    }
  </script>
</body>
</html>